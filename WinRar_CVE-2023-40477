// In response to reports of exploitation of CVE-2023-40477, this query looks for vulnerable versions (<6.23) spawning CMD.
DeviceProcessEvents
| where ActionType contains "ProcessCreated"
| where ProcessCommandLine startswith "cmd.exe"
| where InitiatingProcessVersionInfoProductName == "WinRAR"
| where InitiatingProcessFileName contains "WinRAR"
| where InitiatingProcessVersionInfoProductVersion !startswith "6.23"
| distinct ProcessCreationTime, DeviceName, AccountName, MachineGroup, InitiatingProcessVersionInfoProductVersion, InitiatingProcessFileName, ProcessCommandLine
